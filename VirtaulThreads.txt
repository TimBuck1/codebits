
package com.infoworld;

import java.util.Random;

public class App {
  public static void main( String[] args ) {
    boolean vThreads = args.length > 0;
    System.out.println( "Using vThreads: " + vThreads);

    long start = System.currentTimeMillis();

    Random random = new Random();
    Runnable runnable = () -> { double i = random.nextDouble(1000) % random.nextDouble(1000);  };  
    for (int i = 0; i < 50000; i++){
      if (vThreads){ 
        Thread.startVirtualThread(runnable);
      } else {
        Thread t = new Thread(runnable);
        t.start();
      }
    }
   
    long finish = System.currentTimeMillis();
    long timeElapsed = finish - start;
    System.out.println("Run time: " + timeElapsed);
  }
}


package business;

import java.math.BigDecimal;
import java.util.HashMap;
import java.util.Map;

class Tax {
    private int id;
    private int rootId;
    private BigDecimal amount;
    private String group;

    public Tax(int id, int rootId, BigDecimal amount, String group) {
        this.id = id;
        this.rootId = rootId;
        this.amount = amount;
        this.group = group;
    }

    public int getId() {
        return id;
    }

    public int getRootId() {
        return rootId;
    }

    public BigDecimal getAmount() {
        return amount;
    }

    public void setAmount(BigDecimal amount) {
        this.amount = amount;
    }

    public String getGroup() {
        return group;
    }
}

public class TaxCalculator {
    private Map<Integer, Tax> taxes = new HashMap<>();

    public void addTax(Tax tax) {
        taxes.put(tax.getId(), tax);
    }

    public void calculateAmounts() {
        for (Tax tax : taxes.values()) {
            int rootId = tax.getRootId();
            if (rootId != -1) {
                Tax parentTax = taxes.get(rootId);
                if (parentTax != null && parentTax.getGroup().equals(tax.getGroup())) {
                    BigDecimal parentAmount = parentTax.getAmount();
                    BigDecimal childAmount = tax.getAmount().add(parentAmount);
                    tax.setAmount(childAmount);
                }
            }
        }
    }

    public void printTaxAmounts() {
        for (Tax tax : taxes.values()) {
            System.out.println("Tax ID: " + tax.getId() + ", Amount: " + tax.getAmount());
        }
    }

    public static void main(String[] args) {
        TaxCalculator taxCalculator = new TaxCalculator();

        // Adding sample taxes
        taxCalculator.addTax(new Tax(1, -1, new BigDecimal("100.00"), "Payments"));  // Parent tax
        taxCalculator.addTax(new Tax(1, -1, new BigDecimal("100.00"), "Payments"));  // Parent tax
        taxCalculator.addTax(new Tax(3, 1, new BigDecimal("25.00"), "Payments"));   
        taxCalculator.addTax(new Tax(2, 1, new BigDecimal("50.00"), "VAT"));    // Child tax initially with amount 0

        // Calculate amounts
        taxCalculator.calculateAmounts();

        // Print tax amounts
        taxCalculator.printTaxAmounts();
    }
}


package business;

import java.math.BigDecimal;
import java.util.*;
import java.util.stream.Collectors;

class Tax {
    private int id;
    private Map<Integer, BigDecimal> parentAmounts;
    private BigDecimal amount;
    private String group;
    private int rootId;

    public Tax(int id,int rootId, BigDecimal amount, String group) {
        this.id = id;
        this.rootId=rootId;
        this.parentAmounts = new HashMap<>();
        this.amount = amount;
        this.group = group;
    }

 
	public int getId() {
        return id;
    }

    public Map<Integer, BigDecimal> getParentAmounts() {
        return parentAmounts;
    }

    public BigDecimal getAmount() {
        return amount;
    }

    public void setAmount(BigDecimal amount) {
        this.amount = amount;
    }

    public String getGroup() {
        return group;
    }


	public int getRootId() {
		return rootId;
	}


	public void setRootId(int rootId) {
		this.rootId = rootId;
	}
    
}
public class TaxCalculator {
    private Map<Integer, List<Tax>> taxes = new HashMap<>();

    public void addTax(Tax tax) {
        taxes.computeIfAbsent(tax.getId(), k -> new ArrayList<>()).add(tax);
    }

    public void calculateAmounts() {
        for (List<Tax> taxList : taxes.values()) {
            for (Tax tax : taxList) {
                int rootId = tax.getRootId();
                if (rootId != -1) {
                    // Find all parent taxes with the same ID and group
                    List<Tax> parentTaxes = taxes.get(rootId);
                    if (parentTaxes != null) {
                        BigDecimal childAmount = parentTaxes.stream()
                                .filter(parent -> parent.getGroup().equals(tax.getGroup()))
                                .map(Tax::getAmount)
                                .reduce(BigDecimal.ZERO, BigDecimal::add);

                        // Update the child tax amount
                        tax.setAmount(childAmount);
                    }
                }
            }
        }
    }

    public void printTaxAmounts() {
        for (List<Tax> taxList : taxes.values()) {
            for (Tax tax : taxList) {
                System.out.println("Tax ID: " + tax.getId() + ", Amount: " + tax.getAmount());
            }
        }
    }

    public static void main(String[] args) {
        TaxCalculator taxCalculator = new TaxCalculator();

        // Adding sample taxes
        taxCalculator.addTax(new Tax(1, -1, new BigDecimal("100.00"), "Payments"));  // Parent tax
        taxCalculator.addTax(new Tax(1, -1, new BigDecimal("50.00"), "Payments"));   // Another parent tax with the same ID
        taxCalculator.addTax(new Tax(3, 1, BigDecimal.ZERO, "Payments"));             // Child tax initially with amount 0
        taxCalculator.addTax(new Tax(4, 1, BigDecimal.ZERO, "Payments"));          
        taxCalculator.addTax(new Tax(5, 2, BigDecimal.ZERO, "Payments"));      
        // Calculate amounts
        taxCalculator.calculateAmounts();

        // Print tax amounts
        taxCalculator.printTaxAmounts();
    }
}
