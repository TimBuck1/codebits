SELECT 
    main.orderid,
    main.total_fees,
    COALESCE(MAX(CASE WHEN fee.fee_id = 1 THEN fee.fee_amount END), 0) AS fee1_amount,
    COALESCE(MAX(CASE WHEN fee.fee_id = 2 THEN fee.fee_amount END), 0) AS fee2_amount
FROM (
    SELECT 
        orderid,
        SUM(fee_amount) AS total_fees
    FROM 
        fee
    GROUP BY 
        orderid
) main
LEFT JOIN 
    fee ON main.orderid = fee.orderid
GROUP BY
    main.orderid, main.total_fees
